From e9c41819b9a5e0cd492e8b9d7849504a440ee723 Mon Sep 17 00:00:00 2001
From: Felicitas Pojtinger <felicitas@pojtinger.com>
Date: Wed, 10 Dec 2025 22:28:04 -0800
Subject: [PATCH] GIR: Only add namespaces if the type is not a primitive type to support WebKit
---
diff --git a/internal/gir/types/template.go b/internal/gir/types/template.go
index d65d46f812567843d68a4de1d81b03653cd71244..68ec681863ea0f7fedfb194102f23fdae081f30d 100644
--- a/internal/gir/types/template.go
+++ b/internal/gir/types/template.go
@@ -142,6 +142,22 @@ 	f.Pure.Call = append(f.Pure.Call, c)
 	f.Pure.Full = append(f.Pure.Full, n+" "+t)
 }
 
+// isGoPrimitive checks if a type name (without [] or *) is a Go primitive type
+func isGoPrimitive(typeName string) bool {
+	baseType := strings.TrimLeft(typeName, "[]*")       // Strip [] and * prefixes to get the base type
+	if idx := strings.Index(baseType, "]"); idx != -1 { // Handle cases like "[2]byte" by removing the array size
+		baseType = baseType[idx+1:]
+	}
+
+	for _, goType := range convList {
+		if goType == baseType {
+			return true
+		}
+	}
+
+	return false
+}
+
 func (f *funcArgsTemplate) Add(p Parameter, ins string, ns string, kinds KindMap) {
 	// get the lookup namespace
 	// as if the interface namespace is non-empty
@@ -156,7 +172,7 @@
 	stars := strings.Count(goType, "*")
 	goType = util.NormalizeNamespace(ns, goType, true)
 
-	if kind != OtherType && kind != UnknownType {
+	if kind != OtherType && kind != UnknownType && !isGoPrimitive(goType) { // // Only add namespace for non-primitive types
 		goType = util.AddNamespace(goType, ins)
 	}
 	if stars > 0 {

