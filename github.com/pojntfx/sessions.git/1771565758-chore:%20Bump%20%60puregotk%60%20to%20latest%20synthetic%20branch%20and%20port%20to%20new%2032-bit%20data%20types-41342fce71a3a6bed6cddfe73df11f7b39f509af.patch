From 41342fce71a3a6bed6cddfe73df11f7b39f509af Mon Sep 17 00:00:00 2001
From: Felicitas Pojtinger <felicitas@pojtinger.com>
Date: Thu, 19 Feb 2026 21:35:58 -0800
Subject: [PATCH] chore: Bump `puregotk` to latest synthetic branch and port to new 32-bit data types

Signed-off-by: Felicitas Pojtinger <felicitas@pojtinger.com>
---
diff --git a/go.mod b/go.mod
index e1d13f145d1ec97de0bcb4745cc08895fdc07124..60dfce8d8909c17e4eabcf54db3a9a6def9fdf37 100644
--- a/go.mod
+++ b/go.mod
@@ -17,3 +17,8 @@ 	github.com/godbus/dbus/v5 v5.1.0 // indirect
 	github.com/jwijenbergh/purego v0.0.0-20251017112123-b71757b9ba42 // indirect
 	golang.org/x/mod v0.27.0 // indirect
 )
+
+replace (
+	github.com/jwijenbergh/purego v0.0.0-20251017112123-b71757b9ba42 => github.com/pojntfx/purego v0.0.0-20260128031338-5429b1e47a6d
+	github.com/jwijenbergh/puregotk v0.0.0-20251201161753-28ec1479c381 => github.com/pojntfx/puregotk v0.0.0-20260220051800-f8a38f1e0894
+)
diff --git a/go.mod.json b/go.mod.json
index c66bdb11577a37a566222de69075c492983de30a..e94beebd87d7d6181b0e1440fa2a6473e064dae9 100644
--- a/go.mod.json
+++ b/go.mod.json
@@ -6,10 +6,10 @@     "type": "file"
   },
   {
     "dest": "vendor/github.com/jwijenbergh/puregotk",
-    "sha256": "2f386c11285dba4ba7bd57f22ba1ac16e93d0fb5a7cc6c4aaae5f6d957867af4",
+    "sha256": "d93f0d9ef34fe264866d0c0410d0a615d9a63752487be2c32ad365af662bbb36",
     "strip-components": 3,
     "type": "archive",
-    "url": "https://proxy.golang.org/github.com/jwijenbergh/puregotk/@v/v0.0.0-20251201161753-28ec1479c381.zip"
+    "url": "https://proxy.golang.org/github.com/pojntfx/puregotk/@v/v0.0.0-20260220051800-f8a38f1e0894.zip"
   },
   {
     "dest": "vendor/github.com/pojntfx/go-gettext",
@@ -48,10 +48,10 @@     "url": "https://proxy.golang.org/github.com/godbus/dbus/v5/@v/v5.1.0.zip"
   },
   {
     "dest": "vendor/github.com/jwijenbergh/purego",
-    "sha256": "aa4903b6c7333843f77e6012d68c89846462f4755fe6201a4069e69547d1000e",
+    "sha256": "fd395b72e7fb11c40f5a5ae7f45f6bde2d37e355a93221ba1c4c0aeaea26f97d",
     "strip-components": 3,
     "type": "archive",
-    "url": "https://proxy.golang.org/github.com/jwijenbergh/purego/@v/v0.0.0-20251017112123-b71757b9ba42.zip"
+    "url": "https://proxy.golang.org/github.com/pojntfx/purego/@v/v0.0.0-20260128031338-5429b1e47a6d.zip"
   },
   {
     "dest": "vendor/golang.org/x/mod",
diff --git a/go.sum b/go.sum
index d7c3eb97dab58691031ebe989225b78966a7e477..6568a3b6102b661a334609732d58a839f770ba6f 100644
--- a/go.sum
+++ b/go.sum
@@ -4,12 +4,12 @@ github.com/goccy/go-yaml v1.18.0 h1:8W7wMFS12Pcas7KU+VVkaiCng+kG8QiFeFwzFb+rwuw=
 github.com/goccy/go-yaml v1.18.0/go.mod h1:XBurs7gK8ATbW4ZPGKgcbrY1Br56PdM69F7LkFRi1kA=
 github.com/godbus/dbus/v5 v5.1.0 h1:4KLkAxT3aOY8Li4FRJe/KvhoNFFxo0m6fNuFUO8QJUk=
 github.com/godbus/dbus/v5 v5.1.0/go.mod h1:xhWf0FNVPg57R7Z0UbKHbJfkEywrmjJnf7w5xrFpKfA=
-github.com/jwijenbergh/purego v0.0.0-20251017112123-b71757b9ba42 h1:kQ0LX4ffJvtONhymro3HzrB8XUa6dIGgrbnkl38Rgl0=
-github.com/jwijenbergh/purego v0.0.0-20251017112123-b71757b9ba42/go.mod h1:amE5lVGstyh2GTEIHFEbgJHmoMD0llIuapnzIlZx7Fc=
-github.com/jwijenbergh/puregotk v0.0.0-20251201161753-28ec1479c381 h1:Cy6in3ph8eGnl0w71S0NnH8ZCj0YhZZHzrwYEgtbtII=
-github.com/jwijenbergh/puregotk v0.0.0-20251201161753-28ec1479c381/go.mod h1:mZu8qSvCSqtVL+xoiebZuicnJijwrLfGRs6/eTVgFlc=
 github.com/pojntfx/go-gettext v0.3.0 h1:f+0O046uP84PNusW3ou3/1qSF4Q7NIjL84pqQy+VXqw=
 github.com/pojntfx/go-gettext v0.3.0/go.mod h1:eGt2r0JKvlPZjiz+GqEDtg92//F30LEV/IB0h42bk40=
+github.com/pojntfx/purego v0.0.0-20260128031338-5429b1e47a6d h1:f4fm8/eZJvaE/tfBomboi8CQByYmbXKxHcP6PBwAM04=
+github.com/pojntfx/purego v0.0.0-20260128031338-5429b1e47a6d/go.mod h1:amE5lVGstyh2GTEIHFEbgJHmoMD0llIuapnzIlZx7Fc=
+github.com/pojntfx/puregotk v0.0.0-20260220051800-f8a38f1e0894 h1:pPTVC5Q/5DJ46RzXKISgtUbZgHl/xampBJtBaPOd1ZQ=
+github.com/pojntfx/puregotk v0.0.0-20260220051800-f8a38f1e0894/go.mod h1:mZu8qSvCSqtVL+xoiebZuicnJijwrLfGRs6/eTVgFlc=
 github.com/rymdport/portal v0.4.3-0.20260218173435-15da1e91be7c h1:6ZwNFlRfahXonqOPLNee4oHdhXupk8w+OVLkaVd0u/Q=
 github.com/rymdport/portal v0.4.3-0.20260218173435-15da1e91be7c/go.mod h1:kFF4jslnJ8pD5uCi17brj/ODlfIidOxlgUDTO5ncnC4=
 golang.org/x/mod v0.27.0 h1:kb+q2PyFnEADO2IEF935ehFUXlWiNjJWtRNgBLSfbxQ=
diff --git a/internal/components/application.go b/internal/components/application.go
index f2d188aeeaf38be7a6f35fcde1b69b60e1c7f7e6..2f8babfb39dbb581217b111a83bee1b91266c35f 100644
--- a/internal/components/application.go
+++ b/internal/components/application.go
@@ -166,7 +166,7 @@ 		appParentQuery.Type,
 		"SessionsApplication",
 		appParentQuery.ClassSize,
 		&appClassInit,
-		appParentQuery.InstanceSize+uint(unsafe.Sizeof(Application{}))+uint(unsafe.Sizeof(&Application{}))+uint(unsafe.Sizeof(&adw.ApplicationWindow{}))+uint(unsafe.Sizeof(&Dial{})),
+		appParentQuery.InstanceSize,
 		&appInstanceInit,
 		0,
 	)
diff --git a/internal/components/dial.go b/internal/components/dial.go
index 0186d1cbbbc89b8b784c49368b8ba7e6d7fb8685..269e0ec31e5ad19cabb76d7227cdd3d7923db1f2 100644
--- a/internal/components/dial.go
+++ b/internal/components/dial.go
@@ -260,7 +260,7 @@ 		parentQuery.Type,
 		"SessionsDial",
 		parentQuery.ClassSize,
 		&classInit,
-		parentQuery.InstanceSize+uint(unsafe.Sizeof(Dial{}))+uint(unsafe.Sizeof(&Dial{})),
+		parentQuery.InstanceSize,
 		&instanceInit,
 		0,
 	)
diff --git a/internal/components/main_window.go b/internal/components/main_window.go
index 59e9b24bd5684a363306dd3ac31c4fa18a66cb1d..2065e3dfab7ffa1d4097c095af03c8dace8da61e 100644
--- a/internal/components/main_window.go
+++ b/internal/components/main_window.go
@@ -43,7 +43,7 @@ 	log                   *slog.Logger
 	totalSec              int
 	running               bool
 	remain                time.Duration
-	timer                 uint
+	timer                 uint32
 	dragging              bool
 	paused                bool
 	held                  bool
@@ -312,7 +312,7 @@ 	}
 	drag.ConnectDragEnd(&onDragEnd)
 
 	click := gtk.NewGestureClick()
-	onPress := func(_ gtk.GestureClick, _ int, x float64, y float64) {
+	onPress := func(_ gtk.GestureClick, _ int32, x float64, y float64) {
 		w.handleDialing(x, y)
 	}
 	click.ConnectPressed(&onPress)
@@ -442,7 +442,7 @@ 		windowParentQuery.Type,
 		"SessionsMainWindow",
 		windowParentQuery.ClassSize,
 		&windowClassInit,
-		windowParentQuery.InstanceSize+uint(unsafe.Sizeof(MainWindow{}))+uint(unsafe.Sizeof(&MainWindow{})),
+		windowParentQuery.InstanceSize,
 		&windowInstanceInit,
 		0,
 	)
diff --git a/main.go b/main.go
index 5185f48acd7a23c343ec6aa40e9377a60b04297f..6a87a10159c48eb5cecf7227a7ae48610ec6f96e 100644
--- a/main.go
+++ b/main.go
@@ -60,5 +60,5 @@ 		"application_id", resources.AppID,
 		"flags", gio.GApplicationDefaultFlagsValue,
 	)
 
-	os.Exit(app.Run(len(os.Args), os.Args))
+	os.Exit(int(app.Run(int32(len(os.Args)), os.Args)))
 }
diff --git a/modules.txt b/modules.txt
index 7192e62a565fd4e92ff14665d27282227209835d..3821b0e808a37255725fe440f718f82414c201bf 100644
--- a/modules.txt
+++ b/modules.txt
@@ -15,14 +15,14 @@ github.com/goccy/go-yaml/token
 # github.com/godbus/dbus/v5 v5.1.0
 ## explicit; go 1.12
 github.com/godbus/dbus/v5
-# github.com/jwijenbergh/purego v0.0.0-20251017112123-b71757b9ba42
+# github.com/jwijenbergh/purego v0.0.0-20251017112123-b71757b9ba42 => github.com/pojntfx/purego v0.0.0-20260128031338-5429b1e47a6d
 ## explicit; go 1.18
 github.com/jwijenbergh/purego
 github.com/jwijenbergh/purego/internal/cgo
 github.com/jwijenbergh/purego/internal/fakecgo
 github.com/jwijenbergh/purego/internal/strings
 github.com/jwijenbergh/purego/internal/xreflect
-# github.com/jwijenbergh/puregotk v0.0.0-20251201161753-28ec1479c381
+# github.com/jwijenbergh/puregotk v0.0.0-20251201161753-28ec1479c381 => github.com/pojntfx/puregotk v0.0.0-20260220051800-f8a38f1e0894
 ## explicit; go 1.23.0
 github.com/jwijenbergh/puregotk/internal/core
 github.com/jwijenbergh/puregotk/pkg/core

